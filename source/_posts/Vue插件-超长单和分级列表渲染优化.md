---
title: Vue插件--超长单和分级列表渲染优化
date: 2020-04-27
tags: [Vue实战,技能篇]
---

### 前言

因为工作需要，需要处理一个10w+数据量的transfer，所以将公司原先组件进行重构和升级。
这篇教程主要内容为：
1. 前提基础学习：GUI渲染时机、常见的超长列表渲染
2. 超长单列表的渲染以及优化
3. 再1的基础上，兼容分级列表
4. 选择器transfer的构造
5. 封装成插件，发布到npm上

### 1. 前提基础学习

#### a.GUI渲染时机

首先了解这个，要先了解js引擎是怎么工作的。

js引擎是单核引擎，也就是说，js引擎只能开一条线程来处理进程。我们可以把这条线程，看成**执行栈**，里面会顺序推入要执行的代码块（比如函数），执行这块代码再去处理下块代码。

那遇到异步任务怎么实现异步呢，关于这个可以参考下面流程图:
![流程图]()

①首先可以将一个js脚本看成一个宏任务，然后从上至下依次执行代码，遇到异步任务。②将异步任务分类，如果是微任务（如`Promsie`）就将微任务的回调函数放入微任务队列，如果是宏任务，就等宏任务成功或者时间到了（此时js引擎会将这个任务挂起，继续执行当前的同步代码），将成功回调放入宏任务队列。③当前同步代码全部执行完毕后，js引擎会去触发`EventLoop轮询处理线程`，先去看当前微任务队列是有有任务，若有任务，从队头任务开始执行，④等当前微任务队列清空后，**浏览器会进行一次GUI渲染**，⑤然后会去取一个宏任务放到执行栈，开始执行同步代码，遇到异步任务重复②

以上便是EventLoop的原理。得出结论：**GUI渲染是在当前任务清空之后，执行下一个宏任务之前，进行的！**

* 举例说明：要如何去测试函数和页面渲染性能呢


